<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Model Marketplace</title>
    <script src="https://cdn.jsdelivr.net/npm/web3/dist/web3.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        .container {
            width: 90%;
            margin: auto;
            padding: 20px;
        }
        .section {
            margin-bottom: 30px;
        }
        button {
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>AI Model Marketplace</h1>

        <div class="section" id="list-model">
            <h2>List a New Model</h2>
            <form id="listModelForm">
                <input type="text" id="modelName" placeholder="Model Name" required>
                <textarea id="modelDescription" placeholder="Model Description" required></textarea>
                <input type="number" id="modelPrice" placeholder="Price in Wei" required>
                <button type="submit">List Model</button>
            </form>
        </div>

        <div class="section" id="model-list">
            <h2>Available Models</h2>
            <div id="models"></div>
        </div>

        <div class="section" id="rate-model">
            <h2>Rate a Purchased Model</h2>
            <form id="rateModelForm">
                <input type="number" id="rateModelId" placeholder="Model ID" required>
                <input type="number" id="rating" placeholder="Rating (1-5)" required>
                <button type="submit">Rate Model</button>
            </form>
        </div>

        <div class="section" id="withdraw-funds">
            <h2>Withdraw Funds</h2>
            <button id="withdrawButton">Withdraw</button>
        </div>
    </div>

    <script>
        const contractAddress = "0x43Aa6387F7FffecBf18B2A03EA0b47DBB67F880a"; // Replace with your deployed contract address
        const contractABI = [
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "description",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "price",
				"type": "uint256"
			}
		],
		"name": "listModel",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "modelId",
				"type": "uint256"
			}
		],
		"name": "purchaseModel",
		"outputs": [],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "modelId",
				"type": "uint256"
			},
			{
				"internalType": "uint8",
				"name": "rating",
				"type": "uint8"
			}
		],
		"name": "rateModel",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"inputs": [],
		"name": "withdrawFunds",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"stateMutability": "payable",
		"type": "receive"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "modelId",
				"type": "uint256"
			}
		],
		"name": "getModelDetails",
		"outputs": [
			{
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "description",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "price",
				"type": "uint256"
			},
			{
				"internalType": "address",
				"name": "creator",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "averageRating",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "modelCount",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "models",
		"outputs": [
			{
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "description",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "price",
				"type": "uint256"
			},
			{
				"internalType": "address payable",
				"name": "creator",
				"type": "address"
			},
			{
				"internalType": "uint8",
				"name": "ratingCount",
				"type": "uint8"
			},
			{
				"internalType": "uint256",
				"name": "totalRating",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "owner",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
]; // Replace with the ABI JSON

        let web3, contract;

        window.onload = async () => {
            if (window.ethereum) {
                web3 = new Web3(window.ethereum);
                await window.ethereum.request({ method: 'eth_requestAccounts' });
                const accounts = await web3.eth.getAccounts();

                contract = new web3.eth.Contract(contractABI, contractAddress);

                // Load models
                loadModels();

                // Event Listeners
                document.getElementById('listModelForm').onsubmit = listModel;
                document.getElementById('rateModelForm').onsubmit = rateModel;
                document.getElementById('withdrawButton').onclick = withdrawFunds;
            } else {
                alert("Please install Metamask to use this dApp");
            }
        };

        async function listModel(event) {
            event.preventDefault();

            const name = document.getElementById('modelName').value;
            const description = document.getElementById('modelDescription').value;
            const price = document.getElementById('modelPrice').value;

            const accounts = await web3.eth.getAccounts();
            await contract.methods.listModel(name, description, price).send({ from: accounts[0] });
            alert('Model listed successfully!');
            loadModels();
        }

        async function loadModels() {
            const modelCount = await contract.methods.modelCount().call();
            const modelsContainer = document.getElementById('models');
            modelsContainer.innerHTML = '';

            for (let i = 0; i < modelCount; i++) {
                const model = await contract.methods.getModelDetails(i).call();

                const modelDiv = document.createElement('div');
                modelDiv.innerHTML = `
                    <h3>${model.name}</h3>
                    <p>${model.description}</p>
                    <p>Price: ${model.price} Wei</p>
                    <button onclick="purchaseModel(${i}, ${model.price})">Purchase</button>
                `;
                modelsContainer.appendChild(modelDiv);
            }
        }

        async function purchaseModel(modelId, price) {
            const accounts = await web3.eth.getAccounts();
            await contract.methods.purchaseModel(modelId).send({ from: accounts[0], value: price });
            alert('Model purchased successfully!');
        }

        async function rateModel(event) {
            event.preventDefault();

            const modelId = document.getElementById('rateModelId').value;
            const rating = document.getElementById('rating').value;

            const accounts = await web3.eth.getAccounts();
            await contract.methods.rateModel(modelId, rating).send({ from: accounts[0] });
            alert('Model rated successfully!');
        }

        async function withdrawFunds() {
            const accounts = await web3.eth.getAccounts();
            await contract.methods.withdrawFunds().send({ from: accounts[0] });
            alert('Funds withdrawn successfully!');
        }
    </script>
</body>
</html>
